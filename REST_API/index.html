<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Demo Quản lý Sinh viên với API</title>
  <style>
    table, th, td {
      border: 1px solid #ccc;
      border-collapse: collapse;
      padding: 8px;
    }
    table {
      width: 100%;
      margin-top: 10px;
    }
    input, button {
      padding: 5px;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h2>Danh sách sinh viên</h2>
  <table id="studentTable">
    <thead>
      <tr><th>ID</th><th>Tên</th><th>Email</th><th>Thao tác</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Thêm / Sửa sinh viên</h3>
  <form id="studentForm">
    <input type="hidden" id="studentId" />
    <input type="text" id="nameInput" placeholder="Tên sinh viên" required />
    <input type="email" id="emailInput" placeholder="Email" required />
    <button type="submit">Lưu</button>
    <button type="button" id="cancelBtn">Hủy</button>
  </form>

  <script>
    const apiURL = 'https://jsonplaceholder.typicode.com/users';
    const studentTableBody = document.querySelector('#studentTable tbody');
    const studentForm = document.getElementById('studentForm');
    const studentIdInput = document.getElementById('studentId');
    const nameInput = document.getElementById('nameInput');
    const emailInput = document.getElementById('emailInput');
    const cancelBtn = document.getElementById('cancelBtn');

    // 1. Lấy danh sách sinh viên (GET)
    async function fetchStudents() {
      const res = await fetch(apiURL);
      const students = await res.json();
      renderTable(students);
    }

    // 2. Hiển thị dữ liệu lên bảng
    function renderTable(students) {
      studentTableBody.innerHTML = '';
      students.forEach(student => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${student.id}</td>
          <td>${student.name}</td>
          <td>${student.email}</td>
          <td>
            <button onclick="editStudent(${student.id})">Sửa</button>
            <button onclick="deleteStudent(${student.id})">Xóa</button>
          </td>
        `;
        studentTableBody.appendChild(tr);
      });
    }

    // 3. Thêm hoặc sửa sinh viên (POST hoặc PUT)
    studentForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = studentIdInput.value;
      const name = nameInput.value;
      const email = emailInput.value;
      const studentData = { name, email };

      if (id) {
        // PUT: cập nhật sinh viên
        const res = await fetch(`${apiURL}/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(studentData)
        });
        const updatedStudent = await res.json();
        alert(`Đã cập nhật sinh viên ID ${updatedStudent.id}`);
      } else {
        // POST: thêm sinh viên mới
        const res = await fetch(apiURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(studentData)
        });
        const newStudent = await res.json();
        alert(`Đã thêm sinh viên ID ${newStudent.id}`);
      }
      studentForm.reset();
      studentIdInput.value = '';
      fetchStudents();
    });

    // 4. Xóa sinh viên (DELETE)
    async function deleteStudent(id) {
      if (confirm(`Bạn có chắc chắn muốn xóa sinh viên ID ${id}?`)) {
        await fetch(`${apiURL}/${id}`, { method: 'DELETE' });
        alert(`Đã xóa sinh viên ID ${id}`);
        fetchStudents();
      }
    }

    // 5. Sửa sinh viên: load data lên form
    async function editStudent(id) {
      const res = await fetch(`${apiURL}/${id}`);
      const student = await res.json();
      studentIdInput.value = student.id;
      nameInput.value = student.name;
      emailInput.value = student.email;
    }

    cancelBtn.addEventListener('click', () => {
      studentForm.reset();
      studentIdInput.value = '';
    });

    // Load lần đầu
    fetchStudents();
  </script>
</body>
</html>
